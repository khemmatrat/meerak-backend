<!DOCTYPE html>
<html>
<body>
  <h2>üì§ Cloudinary Upload (Fixed - No 413 Error)</h2>
  
  <div>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Upload File</button>
  </div>
  
  <div style="margin-top: 20px;">
    <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</p>
    <label>
      <input type="radio" name="method" value="form" checked> FormData (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
    </label><br>
    <label>
      <input type="radio" name="method" value="base64"> Base64 (‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å)
    </label>
  </div>
  
  <div id="result" style="margin-top: 20px;"></div>

  <script>
    // ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ FormData (‡πÑ‡∏°‡πà‡∏°‡∏µ 413 error)
    async function uploadFormData(file) {
      const formData = new FormData();
      formData.append('file', file);
      
      try {
        const response = await fetch('http://localhost:3001/api/upload/form', {
          method: 'POST',
          body: formData
          // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á Content-Type
        });
        
        return await response.json();
      } catch (error) {
        console.error('FormData upload error:', error);
        return { success: false, error: error.message };
      }
    }
    
    // ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ Base64 (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å)
    async function uploadBase64(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        
        reader.onload = async function(e) {
          const base64 = e.target.result;
          
          try {
            const response = await fetch('http://localhost:3001/api/upload', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                file: base64,
                fileName: file.name
              })
            });
            
            resolve(await response.json());
          } catch (error) {
            resolve({ success: false, error: error.message });
          }
        };
        
        reader.readAsDataURL(file);
      });
    }
    
    async function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files[0]) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      
      const file = fileInput.files[0];
      const method = document.querySelector('input[name="method"]:checked').value;
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      document.getElementById('result').innerHTML = `
        <div style="background:#fff3cd; padding:15px; border-radius:5px;">
          <p>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î: ${file.name} (${(file.size/1024/1024).toFixed(2)}MB)</p>
          <p>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£: ${method === 'form' ? 'FormData' : 'Base64'}</p>
        </div>
      `;
      
      let result;
      
      if (method === 'form') {
        // ‡πÉ‡∏ä‡πâ FormData (‡πÑ‡∏°‡πà‡∏°‡∏µ size limit issue)
        result = await uploadFormData(file);
      } else {
        // ‡πÉ‡∏ä‡πâ Base64 (‡∏≠‡∏≤‡∏à‡∏°‡∏µ limit)
        if (file.size > 5 * 1024 * 1024) {
          document.getElementById('result').innerHTML = `
            <div style="background:#f8d7da; padding:15px; border-radius:5px;">
              <h3>‚ö†Ô∏è ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Base64</h3>
              <p>‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏ô‡∏≤‡∏î: ${(file.size/1024/1024).toFixed(2)}MB</p>
              <p>Limit: 5MB</p>
              <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ FormData ‡πÅ‡∏ó‡∏ô</p>
            </div>
          `;
          return;
        }
        result = await uploadBase64(file);
      }
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
      if (result.success) {
        document.getElementById('result').innerHTML = `
          <div style="background:#d4edda; padding:15px; border-radius:5px;">
            <h3>‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p><strong>‡πÑ‡∏ü‡∏•‡πå:</strong> ${file.name}</p>
            <p><strong>URL:</strong> <a href="${result.url}" target="_blank">${result.url}</a></p>
            <p><strong>‡∏Ç‡∏ô‡∏≤‡∏î:</strong> ${result.size || (file.size/1024).toFixed(2)}KB</p>
            
            ${file.type.startsWith('image/') ? 
              `<img src="${result.url}" width="300" style="border-radius:5px; margin-top:10px;">` : ''}
            
            ${file.type.startsWith('video/') ? 
              `<video src="${result.url}" controls width="300" style="margin-top:10px;"></video>` : ''}
          </div>
        `;
      } else {
        document.getElementById('result').innerHTML = `
          <div style="background:#f8d7da; padding:15px; border-radius:5px;">
            <h3>‚ùå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</h3>
            <p><strong>‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:</strong> ${result.error}</p>
            <p><strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ FormData ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå</p>
          </div>
        `;
      }
    }
  </script>
</body>
</html>